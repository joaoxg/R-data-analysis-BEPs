")
str(personalmeasure)
#calculate the costs of the personal measures bough
personalmeasure$calculated_costs <-
personalmeasure$cost_absolute +
(personalmeasure$cost_percentage_income/100)*personalmeasure$round_income +
(personalmeasure$cost_percentage_house/100)*personalmeasure$mortgage_payment*10
head(personalmeasure)
#calculate the cumulative of the personal measures to compare it against the cost of house measures bought
personalmeasure_cumulative <- personalmeasure %>%
arrange(player_code, groupround_round_number) %>%   # ensure proper order
group_by(player_code, groupround_round_number) %>%  # group by player and round
#add up costs within each round for each player (since you may have multiple rows per round)
summarise(calculated_costs_pearsonal_measures = sum(calculated_costs),# sum across rows in the round
total_bought_measures = first(cost_house_measures_bought), # keep the round’s value
.groups = "drop"
) %>%
#ensure cumulative totals are calculated separately for each player
mutate(
difference = calculated_costs_pearsonal_measures - total_bought_measures
) %>%
group_by(player_code) %>%
arrange(groupround_round_number) %>%
# compute the running total across rounds
mutate(
cum_costs       = cumsum(calculated_costs_pearsonal_measures),
cum_difference  = cumsum(difference)
)
# Add to the housemeasure the housegroup selection to calculate the cost of measures
housemeasure <- sqldf("
SELECT hm.*, hg.code AS house_code, hg.owner_id
FROM [housemeasure] AS hm
LEFT JOIN [housegroup] AS hg
ON hm.housegroup_id = hg.id
ORDER BY hg.owner_id
")
housemeasure <- sqldf("
SELECT hm.*, pr.group_name, pr.player_id, pr.player_code, pr.groupround_round_number, pr.round_income, pr.cost_house_measures_bought
FROM [housemeasure] AS hm
LEFT JOIN [playerround] AS pr
ON hm.owner_id = pr.player_id AND hm.bought_in_round = pr.groupround_round_number
ORDER BY pr.player_code ASC
")
# Add to the measuretype selection to compare it with the costs of measures per round
housemeasure <- sqldf("
SELECT hm.*, m.short_alias, m.cost_absolute, m.satisfaction_delta_once, m.pluvial_protection_delta, m.fluvial_protection_delta
FROM [housemeasure] AS hm
LEFT JOIN [measuretype] AS m
ON hm.measuretype_id = m.id
ORDER BY hm.player_code ASC
")
#calculate the cumulative of the personal measures to compare it against the cost of house measures bought
housemeasure_cumulative <- housemeasure %>%
arrange(player_code, groupround_round_number) %>%   # ensure proper order
group_by(player_code, groupround_round_number) %>%  # group by player and round
#add up costs within each round for each player (since you may have multiple rows per round)
summarise(calculated_costs_house_measures = sum(cost_absolute),# sum across rows in the round
total_bought_measures = first(cost_house_measures_bought), # keep the round’s value
.groups = "drop"
) %>%
#ensure cumulative totals are calculated separately for each player
mutate(
difference = calculated_costs_house_measure - total_bought_measures
) %>%
group_by(player_code) %>%
arrange(groupround_round_number) %>%
# compute the running total across rounds
mutate(
cum_costs       = cumsum(calculated_costs_house_measure),
cum_difference  = cumsum(difference)
)
housemeasure_cumulative <- housemeasure %>%
arrange(player_code, groupround_round_number) %>%   # ensure proper order
group_by(player_code, groupround_round_number) %>%  # group by player and round
#add up costs within each round for each player (since you may have multiple rows per round)
summarise(calculated_costs_house_measures = sum(cost_absolute),# sum across rows in the round
total_bought_measures = first(cost_house_measures_bought), # keep the round’s value
.groups = "drop"
) %>%
#ensure cumulative totals are calculated separately for each player
mutate(
difference = calculated_costs_house_measures - total_bought_measures
) %>%
group_by(player_code) %>%
arrange(groupround_round_number) %>%
# compute the running total across rounds
mutate(
cum_costs       = cumsum(calculated_costs_house_measures),
cum_difference  = cumsum(difference)
)
View(housemeasure_cumulative)
playerround <- sqldf("
SELECT pr.*, calculated_costs_house_measures
FROM [playerround] AS pr
LEFT JOIN [housemeasure_cumulative] AS hmc
ON pr.player_code = hmc.player_code AND pr.groupround_round_number = hmc.groupround_round_number
ORDER BY pm.player_code ASC
")
playerround <- sqldf("
SELECT pr.*, calculated_costs_house_measures
FROM [playerround] AS pr
LEFT JOIN [housemeasure_cumulative] AS hmc
ON pr.player_code = hmc.player_code AND pr.groupround_round_number = hmc.groupround_round_number
ORDER BY pr.player_code ASC
")
View(playerround)
playerround <- sqldf("
SELECT pr.*, calculated_costs_pearsonal_measures
FROM [playerround] AS pr
LEFT JOIN [personalmeasure_cumulative] AS pmc
ON pr.player_code = pmc.player_code AND pr.groupround_round_number = pmc.groupround_round_number
ORDER BY pr.player_code ASC
")
playerround$calculated_costs_difference <- cost_house_measures_bought - (calculated_costs_pearsonal_measures + calculated_costs_house_measures)
playerround$calculated_costs_difference <- playerround$cost_house_measures_bought -
(playerround$calculated_costs_pearsonal_measures + playerround$calculated_costs_house_measures)
playerround <- sqldf("
SELECT pr.*, hg.code AS house_code
FROM [playerround] AS pr
LEFT JOIN [housegroup] AS hg
ON pr.final_housegroup_id = hg.id
ORDER BY pr.player_code ASC
")
source("~/TUDelft/18_Game Data Analysis/R data analysis BEPs/Scripts_vjcortesa/GP2_vjcortesa_Player spending_all sessions.R")
source("~/TUDelft/18_Game Data Analysis/R data analysis BEPs/Scripts_vjcortesa/GP2_vjcortesa_Player spending_all sessions.R")
source("~/TUDelft/18_Game Data Analysis/R data analysis BEPs/Scripts_vjcortesa/GP2_vjcortesa_Player spending_all sessions.R")
str(round)
source("~/TUDelft/18_Game Data Analysis/R data analysis BEPs/Scripts_vjcortesa/GP2_vjcortesa_Player spending_all sessions.R")
source("~/TUDelft/18_Game Data Analysis/R data analysis BEPs/Scripts_vjcortesa/GP2_vjcortesa_Player spending_all sessions.R")
# Load necessary libraries
library(readxl)
library(readr)
# Load if using RStudio (interactive session)
library(rstudioapi)
# Load for database manipulation
library(sqldf)
# Load for data manipulation
library(dplyr)
library(stringr)
# Load for excel manipulation
library(writexl)
# Load for data visualisation
library(tidyr)
library(ggplot2)
library(ggtext)
# Step 1: Data Settings ---------------------------------------------------
# Get the path of the current script (works in RStudio),
# For example,  ".../R data analysis BEPs/Scripts_vjcortesa/GP2_vjcortesa_check errors.R/functions"
scriptfolder_path <- dirname(rstudioapi::getActiveDocumentContext()$path)
setwd(scriptfolder_path)
# Set path to the input directories
functionfolder_path <- file.path(scriptfolder_path,"functions")
dataset_path <- file.path(dirname(scriptfolder_path),"Datasets")
# Set path to the output directories
data_output_path <- file.path("data_output", "GS2_25-24_sessions")
# Create the folder automatically if it doesn't exist
if (!dir.exists(data_output_path)) {
dir.create(data_output_path, recursive = TRUE)
}
fig_output_path <- file.path("fig_output", "GS2_25-24_sessions")
# Create the folder automatically if it doesn't exist
if (!dir.exists(fig_output_path)) {
dir.create(fig_output_path, recursive = TRUE)
}
github <- "vjcortesa"
# Load required functions
source(file.path(functionfolder_path, "Combine_csvs_to_excel_function_vjcortesa.R"))
source(file.path(functionfolder_path, "Read_all_csvs_function_vjcortesa.R"))
source(file.path(functionfolder_path, "GP2_vjcortesa_income_dist_table_function.R"))
# Read the database folder to create accordingly the dataframe tables
#session_2510 <- "housinggame_session_20_251007_VerzekeraarsMasterClass"
#session_2509 <- "housinggame_session_19_250923_EPA_IntroDays_Overasselt"
session_2409 <- "housinggame_session_16_240924_EPA_IntroDays_Ommen"
# Set the Dataset folder path dynamically
# Read all tables in the folder with the custom function
#csv_list_2510 <- read_all_csvs(dataset_path, session_2510)
#csv_list_2509 <- read_all_csvs(dataset_path, session_2509)
csv_list_2409 <- read_all_csvs(dataset_path, session_2409)
# Create a combined excel with all database tables to have as a reference their initial configuration
#combine_csvs_to_excel(dataset_path,session_2510)
#combine_csvs_to_excel(dataset_path,session_2509)
combine_csvs_to_excel(dataset_path,session_2409)
# Step 2: Data Preparation ---------------------------------------------------
# Checks for possible errors in the spendable income calculation
# Select the relevant tables for the income distribution
GP2_tables <- c("gamesession", "group", "groupround", "playerround", "player","measuretype","personalmeasure","housemeasure")
# Select the variables for the income distribution plot
var_income_dist <- c(
"playerround_id", "player_id", "player_code", "groupround_id", "groupround_round_number",
"round_income", "living_costs", "paid_debt",
"profit_sold_house", "spent_savings_for_buying_house",
"cost_taxes", "mortgage_payment",
"cost_house_measures_bought", "cost_personal_measures_bought",
"cost_fluvial_damage", "cost_pluvial_damage",
"spendable_income"
)
GP2_2509 <- income_dist_table(csv_list_2509, GP2_tables, var_income_dist)
# Load necessary libraries
library(readxl)
library(readr)
# Load if using RStudio (interactive session)
library(rstudioapi)
# Load for database manipulation
library(sqldf)
# Load for data manipulation
library(dplyr)
library(stringr)
# Load for excel manipulation
library(writexl)
# Load for data visualisation
library(tidyr)
library(ggplot2)
library(ggtext)
# Step 1: Data Settings ---------------------------------------------------
# Get the path of the current script (works in RStudio),
# For example,  ".../R data analysis BEPs/Scripts_vjcortesa/GP2_vjcortesa_check errors.R/functions"
scriptfolder_path <- dirname(rstudioapi::getActiveDocumentContext()$path)
setwd(scriptfolder_path)
# Set path to the input directories
functionfolder_path <- file.path(scriptfolder_path,"functions")
dataset_path <- file.path(dirname(scriptfolder_path),"Datasets")
# Set path to the output directories
data_output_path <- file.path("data_output", "GS2_25-24_sessions")
# Create the folder automatically if it doesn't exist
if (!dir.exists(data_output_path)) {
dir.create(data_output_path, recursive = TRUE)
}
fig_output_path <- file.path("fig_output", "GS2_25-24_sessions")
# Create the folder automatically if it doesn't exist
if (!dir.exists(fig_output_path)) {
dir.create(fig_output_path, recursive = TRUE)
}
github <- "vjcortesa"
# Load required functions
source(file.path(functionfolder_path, "Combine_csvs_to_excel_function_vjcortesa.R"))
source(file.path(functionfolder_path, "Read_all_csvs_function_vjcortesa.R"))
source(file.path(functionfolder_path, "GP2_vjcortesa_income_dist_table_function.R"))
# Read the database folder to create accordingly the dataframe tables
#session_2510 <- "housinggame_session_20_251007_VerzekeraarsMasterClass"
#session_2509 <- "housinggame_session_19_250923_EPA_IntroDays_Overasselt"
session_2409 <- "housinggame_session_16_240924_EPA_IntroDays_Ommen"
# Set the Dataset folder path dynamically
# Read all tables in the folder with the custom function
#csv_list_2510 <- read_all_csvs(dataset_path, session_2510)
#csv_list_2509 <- read_all_csvs(dataset_path, session_2509)
csv_list_2409 <- read_all_csvs(dataset_path, session_2409)
# Create a combined excel with all database tables to have as a reference their initial configuration
#combine_csvs_to_excel(dataset_path,session_2510)
#combine_csvs_to_excel(dataset_path,session_2509)
combine_csvs_to_excel(dataset_path,session_2409)
# Step 2: Data Preparation ---------------------------------------------------
# Checks for possible errors in the spendable income calculation
# Select the relevant tables for the income distribution
GP2_tables <- c("gamesession", "group", "groupround", "playerround", "player","measuretype","personalmeasure","housemeasure")
# Select the variables for the income distribution plot
var_income_dist <- c(
"playerround_id", "player_id", "player_code", "groupround_id", "groupround_round_number",
"round_income", "living_costs", "paid_debt",
"profit_sold_house", "spent_savings_for_buying_house",
"cost_taxes", "mortgage_payment",
"cost_house_measures_bought", "cost_personal_measures_bought",
"cost_fluvial_damage", "cost_pluvial_damage",
"spendable_income"
)
#GP2_2509 <- income_dist_table(csv_list_2509, GP2_tables, var_income_dist)
GP2_2409 <- income_dist_table(csv_list_2409, GP2_tables, var_income_dist)
source("~/TUDelft/18_Game Data Analysis/R data analysis BEPs/Scripts_vjcortesa/GP2_vjcortesa_Player spending_all sessions.R")
View(GP2_2409)
# Load necessary libraries
library(readxl)
library(readr)
# Load if using RStudio (interactive session)
library(rstudioapi)
# Load for database manipulation
library(sqldf)
# Load for data manipulation
library(dplyr)
library(stringr)
# Load for excel manipulation
library(writexl)
# Load for data visualisation
library(tidyr)
library(ggplot2)
library(ggtext)
# Step 1: Data Settings ---------------------------------------------------
# Get the path of the current script (works in RStudio),
# For example,  ".../R data analysis BEPs/Scripts_vjcortesa/GP2_vjcortesa_check errors.R/functions"
scriptfolder_path <- dirname(rstudioapi::getActiveDocumentContext()$path)
setwd(scriptfolder_path)
# Set path to the input directories
functionfolder_path <- file.path(scriptfolder_path,"functions")
dataset_path <- file.path(dirname(scriptfolder_path),"Datasets")
# Set path to the output directories
data_output_path <- file.path("data_output", "GS2_25-24_sessions")
# Create the folder automatically if it doesn't exist
if (!dir.exists(data_output_path)) {
dir.create(data_output_path, recursive = TRUE)
}
fig_output_path <- file.path("fig_output", "GS2_25-24_sessions")
# Create the folder automatically if it doesn't exist
if (!dir.exists(fig_output_path)) {
dir.create(fig_output_path, recursive = TRUE)
}
github <- "vjcortesa"
# Load required functions
source(file.path(functionfolder_path, "Combine_csvs_to_excel_function_vjcortesa.R"))
source(file.path(functionfolder_path, "Read_all_csvs_function_vjcortesa.R"))
source(file.path(functionfolder_path, "GP2_vjcortesa_income_dist_table_function.R"))
# Read the database folder to create accordingly the dataframe tables
#session_2510 <- "housinggame_session_20_251007_VerzekeraarsMasterClass"
#session_2509 <- "housinggame_session_19_250923_EPA_IntroDays_Overasselt"
session_2409 <- "housinggame_session_16_240924_EPA_IntroDays_Ommen"
# Set the Dataset folder path dynamically
# Read all tables in the folder with the custom function
#csv_list_2510 <- read_all_csvs(dataset_path, session_2510)
#csv_list_2509 <- read_all_csvs(dataset_path, session_2509)
csv_list_2409 <- read_all_csvs(dataset_path, session_2409)
# Create a combined excel with all database tables to have as a reference their initial configuration
#combine_csvs_to_excel(dataset_path,session_2510)
#combine_csvs_to_excel(dataset_path,session_2509)
combine_csvs_to_excel(dataset_path,session_2409)
# Step 2: Data Preparation ---------------------------------------------------
# Checks for possible errors in the spendable income calculation
# Select the relevant tables for the income distribution
GP2_tables <- c("gamesession", "group", "groupround", "playerround", "player","measuretype","personalmeasure","housemeasure", "housegroup")
# Select the variables for the income distribution plot
var_income_dist <- c(
"playerround_id", "player_id", "player_code", "groupround_id", "groupround_round_number",
"round_income", "living_costs", "paid_debt",
"profit_sold_house", "spent_savings_for_buying_house",
"cost_taxes", "mortgage_payment",
"cost_house_measures_bought", "cost_personal_measures_bought",
"cost_fluvial_damage", "cost_pluvial_damage",
"spendable_income"
)
#GP2_2509 <- income_dist_table(csv_list_2509, GP2_tables, var_income_dist)
GP2_2409 <- income_dist_table(csv_list_2409, GP2_tables, var_income_dist)
View(GP2_2409)
# Load necessary libraries
library(readxl)
library(readr)
# Load if using RStudio (interactive session)
library(rstudioapi)
# Load for database manipulation
library(sqldf)
# Load for data manipulation
library(dplyr)
library(stringr)
# Load for excel manipulation
library(writexl)
# Load for data visualisation
library(tidyr)
library(ggplot2)
library(ggtext)
# Step 1: Data Settings ---------------------------------------------------
# Get the path of the current script (works in RStudio),
# For example,  ".../R data analysis BEPs/Scripts_vjcortesa/GP2_vjcortesa_check errors.R/functions"
scriptfolder_path <- dirname(rstudioapi::getActiveDocumentContext()$path)
setwd(scriptfolder_path)
# Set path to the input directories
functionfolder_path <- file.path(scriptfolder_path,"functions")
dataset_path <- file.path(dirname(scriptfolder_path),"Datasets")
# Set path to the output directories
data_output_path <- file.path("data_output", "GS2_25-24_sessions")
# Create the folder automatically if it doesn't exist
if (!dir.exists(data_output_path)) {
dir.create(data_output_path, recursive = TRUE)
}
fig_output_path <- file.path("fig_output", "GS2_25-24_sessions")
# Create the folder automatically if it doesn't exist
if (!dir.exists(fig_output_path)) {
dir.create(fig_output_path, recursive = TRUE)
}
github <- "vjcortesa"
# Load required functions
source(file.path(functionfolder_path, "Combine_csvs_to_excel_function_vjcortesa.R"))
source(file.path(functionfolder_path, "Read_all_csvs_function_vjcortesa.R"))
source(file.path(functionfolder_path, "GP2_vjcortesa_income_dist_table_function.R"))
# Read the database folder to create accordingly the dataframe tables
#session_2510 <- "housinggame_session_20_251007_VerzekeraarsMasterClass"
#session_2509 <- "housinggame_session_19_250923_EPA_IntroDays_Overasselt"
session_2409 <- "housinggame_session_16_240924_EPA_IntroDays_Ommen"
# Set the Dataset folder path dynamically
# Read all tables in the folder with the custom function
#csv_list_2510 <- read_all_csvs(dataset_path, session_2510)
#csv_list_2509 <- read_all_csvs(dataset_path, session_2509)
csv_list_2409 <- read_all_csvs(dataset_path, session_2409)
# Create a combined excel with all database tables to have as a reference their initial configuration
#combine_csvs_to_excel(dataset_path,session_2510)
#combine_csvs_to_excel(dataset_path,session_2509)
combine_csvs_to_excel(dataset_path,session_2409)
# Step 2: Data Preparation ---------------------------------------------------
# Checks for possible errors in the spendable income calculation
# Select the relevant tables for the income distribution
GP2_tables <- c("gamesession", "group", "groupround", "playerround", "player","measuretype","personalmeasure","housemeasure", "housegroup")
# Select the variables for the income distribution plot
var_income_dist <- c(
"playerround_id", "player_id", "player_code", "groupround_id", "groupround_round_number",
"round_income", "living_costs", "paid_debt",
"profit_sold_house", "spent_savings_for_buying_house",
"cost_taxes", "mortgage_payment",
"cost_house_measures_bought", "cost_personal_measures_bought",
"cost_fluvial_damage", "cost_pluvial_damage",
"spendable_income",
"calculated_costs_personal_measures",
"calculated_costs_personal_measures"
)
#GP2_2509 <- income_dist_table(csv_list_2509, GP2_tables, var_income_dist)
GP2_2409 <- income_dist_table(csv_list_2409, GP2_tables, var_income_dist)
# Load necessary libraries
library(readxl)
library(readr)
# Load if using RStudio (interactive session)
library(rstudioapi)
# Load for database manipulation
library(sqldf)
# Load for data manipulation
library(dplyr)
library(stringr)
# Load for excel manipulation
library(writexl)
# Load for data visualisation
library(tidyr)
library(ggplot2)
library(ggtext)
# Load necessary libraries
library(readxl)
library(readr)
# Load if using RStudio (interactive session)
library(rstudioapi)
# Load for database manipulation
library(sqldf)
# Load for data manipulation
library(dplyr)
library(stringr)
# Load for excel manipulation
library(writexl)
# Load for data visualisation
library(tidyr)
library(ggplot2)
library(ggtext)
# Step 1: Data Settings ---------------------------------------------------
# Get the path of the current script (works in RStudio),
# For example,  ".../R data analysis BEPs/Scripts_vjcortesa/GP2_vjcortesa_check errors.R/functions"
scriptfolder_path <- dirname(rstudioapi::getActiveDocumentContext()$path)
setwd(scriptfolder_path)
# Set path to the input directories
functionfolder_path <- file.path(scriptfolder_path,"functions")
dataset_path <- file.path(dirname(scriptfolder_path),"Datasets")
# Set path to the output directories
data_output_path <- file.path("data_output", "GS2_25-24_sessions")
# Create the folder automatically if it doesn't exist
if (!dir.exists(data_output_path)) {
dir.create(data_output_path, recursive = TRUE)
}
fig_output_path <- file.path("fig_output", "GS2_25-24_sessions")
# Create the folder automatically if it doesn't exist
if (!dir.exists(fig_output_path)) {
dir.create(fig_output_path, recursive = TRUE)
}
github <- "vjcortesa"
# Load required functions
source(file.path(functionfolder_path, "Combine_csvs_to_excel_function_vjcortesa.R"))
source(file.path(functionfolder_path, "Read_all_csvs_function_vjcortesa.R"))
source(file.path(functionfolder_path, "GP2_vjcortesa_income_dist_table_function.R"))
# Read the database folder to create accordingly the dataframe tables
#session_2510 <- "housinggame_session_20_251007_VerzekeraarsMasterClass"
#session_2509 <- "housinggame_session_19_250923_EPA_IntroDays_Overasselt"
session_2409 <- "housinggame_session_16_240924_EPA_IntroDays_Ommen"
# Set the Dataset folder path dynamically
# Read all tables in the folder with the custom function
#csv_list_2510 <- read_all_csvs(dataset_path, session_2510)
#csv_list_2509 <- read_all_csvs(dataset_path, session_2509)
csv_list_2409 <- read_all_csvs(dataset_path, session_2409)
# Create a combined excel with all database tables to have as a reference their initial configuration
#combine_csvs_to_excel(dataset_path,session_2510)
#combine_csvs_to_excel(dataset_path,session_2509)
combine_csvs_to_excel(dataset_path,session_2409)
# Step 2: Data Preparation ---------------------------------------------------
# Checks for possible errors in the spendable income calculation
# Select the relevant tables for the income distribution
GP2_tables <- c("gamesession", "group", "groupround", "playerround", "player","measuretype","personalmeasure","housemeasure", "housegroup")
# Select the variables for the income distribution plot
var_income_dist <- c(
"playerround_id", "player_id", "player_code", "groupround_id", "groupround_round_number",
"round_income", "living_costs", "paid_debt",
"profit_sold_house", "spent_savings_for_buying_house",
"cost_taxes", "mortgage_payment",
"cost_house_measures_bought", "cost_personal_measures_bought",
"cost_fluvial_damage", "cost_pluvial_damage",
"spendable_income",
"calculated_costs_personal_measures",
"calculated_costs_personal_measures"
)
#GP2_2509 <- income_dist_table(csv_list_2509, GP2_tables, var_income_dist)
GP2_2409 <- income_dist_table(csv_list_2409, GP2_tables, var_income_dist)
# Load necessary libraries
library(readxl)
library(readr)
# Load if using RStudio (interactive session)
library(rstudioapi)
# Load for database manipulation
library(sqldf)
# Load for data manipulation
library(dplyr)
library(stringr)
# Load for excel manipulation
library(writexl)
# Load for data visualisation
library(tidyr)
library(ggplot2)
library(ggtext)
